<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Lista de Servicios PAN</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/notyf/notyf.min.css">
  </head>
  <body>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/notyf/notyf.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <div class="container" style="margin-top: 20px;">
        <div class="card" style="width: 60%;">
            <div class="card-header">
                Lista de Servivios PAN
            </div>
            <div class="card-body">
                <div id="ListServices"></div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        const notyf = new Notyf({
            position: {
                x: 'right', // left | center | right
                y: 'top'    // top | bottom
            }
        });
        $(document).ready(function(){
            ListServices();
        });

        function ListServices(){

            let _html = `<table class="table table-hover"><thead><tr><td></td><td>Nombre</td><td>Estatus</td></tr></thead><tbody>`;

            $.ajax({
                url: 'https://servicespan.azurewebsites.net/Services/GetLisServices',
                type: 'GET',
                dataType: 'json',
                headers: {'ApiKey':'UDu80ib0pgDNrijzxRzCiB9XBAVoGS3y'},
                success: function (response) {
                    response.listServices.forEach(element => {
                        _html += `
                            <tr>
                                <td>${element.id}</td>
                                <td>${element.nombre}</td>`;
                                if(element.estatus === 1){
                                    _html += `<td><div class="form-check form-switch"><input class="form-check-input inputcheckstatus" type="checkbox" role="switch" id="switchCheckDefault" data-id="${element.id}" checked></div></td>`;
                                }
                                else{
                                    _html += `<td><div class="form-check form-switch"><input class="form-check-input inputcheckstatus" type="checkbox" role="switch" id="switchCheckDefault" data-id="${element.id}"></div></td>`;
                                }
                        _html +=  `</tr>`;
                    });

                    _html += `</tbody></table>`;

                    $('#ListServices').html(_html);

                    $(document).on('change', '.inputcheckstatus', function () {

                        const status = $(this).is(':checked');
                        const id = $(this).data('id');

                        UpdateStatusService(id, status);
                    });
                },
                error: function (xhr, status, error) {
                    console.error(xhr.responseText);
                }
            });
        }

        function UpdateStatusService(id, status){
            let st = 0;
            if(status) { st=1; }

            $.ajax({
                url: 'https://servicespan.azurewebsites.net/Services/ServiceActive',
                type: 'POST',
                dataType: 'json',
                headers: {'ApiKey':'UDu80ib0pgDNrijzxRzCiB9XBAVoGS3y'},
                data:{
                    'id': id,
                    'status': st
                },
                success: function (response) {
                    notyf.success('Estatus Actualizado');
                },
                error: function (xhr, status, error) {
                    console.error(xhr.responseText);
                }
            });
        }
    </script>
  </body>
</html>